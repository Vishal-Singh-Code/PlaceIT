{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Vishal%20Singh/Practice%20Project/PlaceIT/lib/db/connection.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\"MONGODB_URI is not set in the environment\");\r\n}\r\n\r\ninterface GlobalMongoose {\r\n  conn: typeof mongoose | null;\r\n  promise: Promise<typeof mongoose> | null;\r\n}\r\n\r\ndeclare global {\r\n  // eslint-disable-next-line no-var\r\n  var _mongoose: GlobalMongoose | undefined;\r\n}\r\n\r\nlet cached = global._mongoose;\r\n\r\nif (!cached) {\r\n  cached = global._mongoose = { conn: null, promise: null };\r\n}\r\n\r\nexport async function connectToDatabase() {\r\n  if (cached!.conn) {\r\n    return cached!.conn;\r\n  }\r\n\r\n  if (!cached!.promise) {\r\n    cached!.promise = mongoose.connect(MONGODB_URI as string, {\r\n      dbName: \"placeit\"\r\n    });\r\n  }\r\n\r\n  cached!.conn = await cached!.promise;\r\n  return cached!.conn;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAYA,IAAI,SAAS,OAAO,SAAS;AAE7B,IAAI,CAAC,QAAQ;IACX,SAAS,OAAO,SAAS,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC1D;AAEO,eAAe;IACpB,IAAI,OAAQ,IAAI,EAAE;QAChB,OAAO,OAAQ,IAAI;IACrB;IAEA,IAAI,CAAC,OAAQ,OAAO,EAAE;QACpB,OAAQ,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAuB;YACxD,QAAQ;QACV;IACF;IAEA,OAAQ,IAAI,GAAG,MAAM,OAAQ,OAAO;IACpC,OAAO,OAAQ,IAAI;AACrB"}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["file:///C:/Vishal%20Singh/Practice%20Project/PlaceIT/lib/db/models/AttemptAnalytics.ts"],"sourcesContent":["import { Schema, model, models, Document, Types } from \"mongoose\";\r\n\r\nexport interface SectionStats {\r\n  sectionId: Types.ObjectId;\r\n  totalQuestions: number;\r\n  correct: number;\r\n  incorrect: number;\r\n  unattempted: number;\r\n  accuracy: number;\r\n  totalTimeSeconds: number;\r\n  avgTimePerQuestionSeconds: number;\r\n  strengthLabel?: string;\r\n}\r\n\r\nexport interface AttemptAnalyticsDocument extends Document {\r\n  attemptId: Types.ObjectId;\r\n  testTemplateId: Types.ObjectId;\r\n  userId: string;\r\n  overallScore: number;\r\n  totalQuestions: number;\r\n  totalCorrect: number;\r\n  totalIncorrect: number;\r\n  totalUnattempted: number;\r\n  accuracy: number;\r\n  sectionStats: SectionStats[];\r\n  percentile?: number;\r\n  rank?: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst SectionStatsSchema = new Schema<SectionStats>(\r\n  {\r\n    sectionId: { type: Schema.Types.ObjectId, ref: \"Section\", required: true },\r\n    totalQuestions: { type: Number, required: true },\r\n    correct: { type: Number, required: true },\r\n    incorrect: { type: Number, required: true },\r\n    unattempted: { type: Number, required: true },\r\n    accuracy: { type: Number, required: true },\r\n    totalTimeSeconds: { type: Number, required: true },\r\n    avgTimePerQuestionSeconds: { type: Number, required: true },\r\n    strengthLabel: String\r\n  },\r\n  { _id: false }\r\n);\r\n\r\nconst AttemptAnalyticsSchema = new Schema<AttemptAnalyticsDocument>(\r\n  {\r\n    attemptId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"TestAttempt\",\r\n      required: true,\r\n      unique: true\r\n    },\r\n    testTemplateId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"TestTemplate\",\r\n      required: true\r\n    },\r\n    userId: { type: String, required: true },\r\n    overallScore: { type: Number, required: true },\r\n    totalQuestions: { type: Number, required: true },\r\n    totalCorrect: { type: Number, required: true },\r\n    totalIncorrect: { type: Number, required: true },\r\n    totalUnattempted: { type: Number, required: true },\r\n    accuracy: { type: Number, required: true },\r\n    sectionStats: { type: [SectionStatsSchema], required: true },\r\n    percentile: Number,\r\n    rank: Number\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nAttemptAnalyticsSchema.index({ testTemplateId: 1, userId: 1 });\r\n\r\nexport const AttemptAnalytics =\r\n  (models.AttemptAnalytics as ReturnType<\r\n    typeof model<AttemptAnalyticsDocument>\r\n  >) ||\r\n  model<AttemptAnalyticsDocument>(\"AttemptAnalytics\", AttemptAnalyticsSchema);\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AA+BA,MAAM,qBAAqB,IAAI,kKAAM,CACnC;IACE,WAAW;QAAE,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAW,UAAU;IAAK;IACzE,gBAAgB;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC/C,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,aAAa;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC5C,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,kBAAkB;QAAE,MAAM;QAAQ,UAAU;IAAK;IACjD,2BAA2B;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1D,eAAe;AACjB,GACA;IAAE,KAAK;AAAM;AAGf,MAAM,yBAAyB,IAAI,kKAAM,CACvC;IACE,WAAW;QACT,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;QACV,QAAQ;IACV;IACA,gBAAgB;QACd,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,cAAc;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC7C,gBAAgB;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC/C,cAAc;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC7C,gBAAgB;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC/C,kBAAkB;QAAE,MAAM;QAAQ,UAAU;IAAK;IACjD,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,cAAc;QAAE,MAAM;YAAC;SAAmB;QAAE,UAAU;IAAK;IAC3D,YAAY;IACZ,MAAM;AACR,GACA;IAAE,YAAY;AAAK;AAGrB,uBAAuB,KAAK,CAAC;IAAE,gBAAgB;IAAG,QAAQ;AAAE;AAErD,MAAM,mBACX,AAAC,kKAAM,CAAC,gBAAgB,IAGxB,IAAA,iKAAK,EAA2B,oBAAoB"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///C:/Vishal%20Singh/Practice%20Project/PlaceIT/lib/db/models/TestAttempt.ts"],"sourcesContent":["import { Schema, model, models, Document, Types } from \"mongoose\";\r\n\r\nexport type AttemptStatus = \"in_progress\" | \"submitted\" | \"auto_submitted\";\r\n\r\nexport interface TestAttemptDocument extends Document {\r\n  testTemplateId: Types.ObjectId;\r\n  userId: string;\r\n  startedAt: Date;\r\n  submittedAt?: Date;\r\n  durationSeconds?: number;\r\n  status: AttemptStatus;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst TestAttemptSchema = new Schema<TestAttemptDocument>(\r\n  {\r\n    testTemplateId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"TestTemplate\",\r\n      required: true\r\n    },\r\n    userId: { type: String, required: true },\r\n    startedAt: { type: Date, required: true },\r\n    submittedAt: Date,\r\n    durationSeconds: Number,\r\n    status: {\r\n      type: String,\r\n      enum: [\"in_progress\", \"submitted\", \"auto_submitted\"],\r\n      default: \"in_progress\"\r\n    }\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nTestAttemptSchema.index({ testTemplateId: 1, userId: 1, status: 1 });\r\n\r\nexport const TestAttempt =\r\n  (models.TestAttempt as ReturnType<typeof model<TestAttemptDocument>>) ||\r\n  model<TestAttemptDocument>(\"TestAttempt\", TestAttemptSchema);\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAeA,MAAM,oBAAoB,IAAI,kKAAM,CAClC;IACE,gBAAgB;QACd,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,WAAW;QAAE,MAAM;QAAM,UAAU;IAAK;IACxC,aAAa;IACb,iBAAiB;IACjB,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAe;YAAa;SAAiB;QACpD,SAAS;IACX;AACF,GACA;IAAE,YAAY;AAAK;AAGrB,kBAAkB,KAAK,CAAC;IAAE,gBAAgB;IAAG,QAAQ;IAAG,QAAQ;AAAE;AAE3D,MAAM,cACX,AAAC,kKAAM,CAAC,WAAW,IACnB,IAAA,iKAAK,EAAsB,eAAe"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///C:/Vishal%20Singh/Practice%20Project/PlaceIT/lib/db/models/Section.ts"],"sourcesContent":["import { Schema, model, models, Document, Types } from \"mongoose\";\r\n\r\nexport interface SectionDocument extends Document {\r\n  examId: Types.ObjectId;\r\n  name: string;\r\n  order: number;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nconst SectionSchema = new Schema<SectionDocument>(\r\n  {\r\n    examId: { type: Schema.Types.ObjectId, ref: \"Exam\", required: true },\r\n    name: { type: String, required: true },\r\n    order: { type: Number, required: true }\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nSectionSchema.index({ examId: 1, order: 1 });\r\n\r\nexport const Section =\r\n  (models.Section as ReturnType<typeof model<SectionDocument>>) ||\r\n  model<SectionDocument>(\"Section\", SectionSchema);\r\n\r\n"],"names":[],"mappings":";;;;AAAA;;AAUA,MAAM,gBAAgB,IAAI,kKAAM,CAC9B;IACE,QAAQ;QAAE,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IACnE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,OAAO;QAAE,MAAM;QAAQ,UAAU;IAAK;AACxC,GACA;IAAE,YAAY;AAAK;AAGrB,cAAc,KAAK,CAAC;IAAE,QAAQ;IAAG,OAAO;AAAE;AAEnC,MAAM,UACX,AAAC,kKAAM,CAAC,OAAO,IACf,IAAA,iKAAK,EAAkB,WAAW"}},
    {"offset": {"line": 227, "column": 0}, "map": {"version":3,"sources":["file:///C:/Vishal%20Singh/Practice%20Project/PlaceIT/lib/services/rankingService.ts"],"sourcesContent":["import { connectToDatabase } from \"../db/connection\";\r\nimport { AttemptAnalytics } from \"../db/models/AttemptAnalytics\";\r\nimport { TestAttempt } from \"../db/models/TestAttempt\";\r\nimport { LeaderboardEntry } from \"../types/leaderboard\";\r\n\r\ninterface ScoreRecord {\r\n  attemptId: string;\r\n  score: number;\r\n  durationSeconds: number | null;\r\n}\r\n\r\nexport function computeRankAndPercentileCore(\r\n  scores: ScoreRecord[],\r\n  targetAttemptId: string\r\n) {\r\n  const sorted = [...scores].sort((a, b) => {\r\n    if (b.score !== a.score) {\r\n      return b.score - a.score;\r\n    }\r\n    const aDur = a.durationSeconds ?? Number.MAX_SAFE_INTEGER;\r\n    const bDur = b.durationSeconds ?? Number.MAX_SAFE_INTEGER;\r\n    return aDur - bDur;\r\n  });\r\n\r\n  const total = sorted.length;\r\n  const index = sorted.findIndex((s) => s.attemptId === targetAttemptId);\r\n  if (index === -1) {\r\n    throw new Error(\"Target attempt not found in scores array\");\r\n  }\r\n\r\n  const rank = index + 1;\r\n  const higherScoreCount = sorted.filter(\r\n    (s) => s.score > sorted[index].score\r\n  ).length;\r\n\r\n  /**\r\n   * Percentile formula:\r\n   * percentile = 100 * (1 - higherScoreCount / totalAttempts)\r\n   *\r\n   * Intuition:\r\n   * - if no one scored higher, percentile = 100\r\n   * - if everyone scored higher, percentile approaches 0\r\n   */\r\n  const percentile =\r\n    total === 0 ? 0 : 100 * (1 - higherScoreCount / total || 0);\r\n\r\n  return { rank, percentile };\r\n}\r\n\r\nexport async function computeRankAndPercentile(\r\n  testTemplateId: string,\r\n  attemptId: string\r\n) {\r\n  await connectToDatabase();\r\n\r\n  const [attempts, analytics] = await Promise.all([\r\n    TestAttempt.find({\r\n      testTemplateId,\r\n      status: { $in: [\"submitted\", \"auto_submitted\"] }\r\n    }).sort({ startedAt: 1 }),\r\n    AttemptAnalytics.find({ testTemplateId })\r\n  ]);\r\n\r\n  const analyticsByAttempt = new Map(\r\n    analytics.map((a) => [a.attemptId.toString(), a])\r\n  );\r\n\r\n  const scores: ScoreRecord[] = attempts.map((attempt) => {\r\n    const analyticsDoc = analyticsByAttempt.get(attempt._id.toString());\r\n    const score = analyticsDoc ? analyticsDoc.overallScore : 0;\r\n    const durationSeconds =\r\n      attempt.durationSeconds ??\r\n      (attempt.submittedAt && attempt.startedAt\r\n        ? Math.max(\r\n            0,\r\n            Math.round(\r\n              (attempt.submittedAt.getTime() - attempt.startedAt.getTime()) /\r\n                1000\r\n            )\r\n          )\r\n        : null);\r\n\r\n    return {\r\n      attemptId: attempt._id.toString(),\r\n      score,\r\n      durationSeconds\r\n    };\r\n  });\r\n\r\n  const { rank, percentile } = computeRankAndPercentileCore(scores, attemptId);\r\n\r\n  const analyticsForAttempt = await AttemptAnalytics.findOne({\r\n    attemptId\r\n  });\r\n  if (analyticsForAttempt) {\r\n    analyticsForAttempt.rank = rank;\r\n    analyticsForAttempt.percentile = percentile;\r\n    await analyticsForAttempt.save();\r\n  }\r\n\r\n  return { rank, percentile };\r\n}\r\n\r\nexport async function getLeaderboard(\r\n  testTemplateId: string,\r\n  limit = 10\r\n): Promise<LeaderboardEntry[]> {\r\n  await connectToDatabase();\r\n\r\n  const analytics = await AttemptAnalytics.find({ testTemplateId })\r\n    .sort({ overallScore: -1, createdAt: 1 })\r\n    .limit(limit);\r\n\r\n  const attempts = await TestAttempt.find({\r\n    _id: { $in: analytics.map((a) => a.attemptId) }\r\n  });\r\n  const attemptsById = new Map(\r\n    attempts.map((a) => [a._id.toString(), a])\r\n  );\r\n\r\n  const entries: LeaderboardEntry[] = analytics.map((a, idx) => {\r\n    const attempt = attemptsById.get(a.attemptId.toString());\r\n    return {\r\n      attemptId: a.attemptId.toString(),\r\n      userId: a.userId,\r\n      score: a.overallScore,\r\n      durationSeconds: attempt ? attempt.durationSeconds ?? null : null,\r\n      startedAt: attempt ? attempt.startedAt.toISOString() : \"\",\r\n      rank: idx + 1\r\n    };\r\n  });\r\n\r\n  return entries;\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 352, "column": 0}, "map": {"version":3,"sources":["file:///C:/Vishal%20Singh/Practice%20Project/PlaceIT/app/attempts/%5BattemptId%5D/result/page.tsx"],"sourcesContent":["import Link from \"next/link\";\r\nimport { connectToDatabase } from \"../../../../lib/db/connection\";\r\nimport { AttemptAnalytics } from \"../../../../lib/db/models/AttemptAnalytics\";\r\nimport { TestAttempt } from \"../../../../lib/db/models/TestAttempt\";\r\nimport { Section } from \"../../../../lib/db/models/Section\";\r\nimport { getLeaderboard } from \"../../../../lib/services/rankingService\";\r\n\r\ninterface Props {\r\n  params: Promise<{ attemptId: string }>;\r\n}\r\n\r\nexport default async function AttemptResultPage(props: Props) {\r\n  const params = await props.params;\r\n  await connectToDatabase();\r\n\r\n  const attempt = await TestAttempt.findById(params.attemptId).lean();\r\n  if (!attempt) {\r\n    return <p className=\"text-sm text-red-400\">Attempt not found.</p>;\r\n  }\r\n\r\n  const analytics = await AttemptAnalytics.findOne({\r\n    attemptId: attempt._id\r\n  }).lean();\r\n\r\n  if (!analytics) {\r\n    return (\r\n      <p className=\"text-sm text-slate-400\">\r\n        Analytics not computed yet for this attempt.\r\n      </p>\r\n    );\r\n  }\r\n\r\n  const sections = await Section.find({\r\n    _id: { $in: analytics.sectionStats.map((s) => s.sectionId) }\r\n  })\r\n    .select({ _id: 1, name: 1 })\r\n    .lean();\r\n\r\n  const sectionNameById = new Map(\r\n    sections.map((s) => [s._id.toString(), s.name as string])\r\n  );\r\n\r\n  const leaderboard = await getLeaderboard(\r\n    analytics.testTemplateId.toString(),\r\n    10\r\n  );\r\n\r\n  const completionLabel =\r\n    attempt.status === \"auto_submitted\" ? \"Auto-submitted\" : \"Completed\";\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <section className=\"rounded-lg border border-slate-800 bg-slate-900/40 p-4\">\r\n        <div className=\"mb-2 flex items-center justify-between\">\r\n          <div>\r\n            <h2 className=\"text-lg font-semibold\">Overall performance</h2>\r\n            <p className=\"text-xs text-slate-400\">\r\n              Attempt ID {attempt._id.toString().slice(-6)}\r\n            </p>\r\n          </div>\r\n          <span className=\"rounded-full bg-slate-800 px-3 py-1 text-xs font-medium text-slate-100\">\r\n            {completionLabel}\r\n          </span>\r\n        </div>\r\n        <div className=\"mt-4 grid gap-4 md:grid-cols-4 text-sm\">\r\n          <div>\r\n            <p className=\"text-xs text-slate-400\">Score</p>\r\n            <p className=\"text-lg font-semibold text-sky-400\">\r\n              {analytics.overallScore} / {analytics.totalQuestions}\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <p className=\"text-xs text-slate-400\">Accuracy</p>\r\n            <p className=\"text-lg font-semibold text-emerald-400\">\r\n              {(analytics.accuracy * 100).toFixed(1)}%\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <p className=\"text-xs text-slate-400\">Rank</p>\r\n            <p className=\"text-lg font-semibold\">\r\n              {analytics.rank ? `#${analytics.rank}` : \"-\"}\r\n            </p>\r\n          </div>\r\n          <div>\r\n            <p className=\"text-xs text-slate-400\">Percentile</p>\r\n            <p className=\"text-lg font-semibold\">\r\n              {analytics.percentile\r\n                ? `${analytics.percentile.toFixed(1)}%`\r\n                : \"-\"}\r\n            </p>\r\n          </div>\r\n        </div>\r\n        <p className=\"mt-3 text-xs text-slate-500\">\r\n          Percentile is computed as 100 × (1 − higherScoreCount / totalAttempts), where\r\n          higherScoreCount is the number of attempts with a strictly higher score.\r\n        </p>\r\n      </section>\r\n\r\n      <section className=\"rounded-lg border border-slate-800 bg-slate-900/40 p-4\">\r\n        <h3 className=\"mb-3 text-sm font-semibold\">Section-wise breakdown</h3>\r\n        <div className=\"grid gap-3 md:grid-cols-3 text-xs\">\r\n          {analytics.sectionStats.map((s) => {\r\n            const name =\r\n              sectionNameById.get(s.sectionId.toString()) ?? \"Section\";\r\n            const accuracyPct = (s.accuracy * 100).toFixed(1);\r\n            return (\r\n              <div\r\n                key={s.sectionId.toString()}\r\n                className=\"space-y-2 rounded border border-slate-800 bg-slate-900/60 p-3\"\r\n              >\r\n                <div className=\"flex items-center justify-between\">\r\n                  <p className=\"font-medium text-slate-200\">{name}</p>\r\n                  <span className=\"rounded-full bg-slate-800 px-2 py-0.5 text-[10px] text-slate-300\">\r\n                    {s.totalQuestions} Qs\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <div className=\"mb-1 flex items-center justify-between\">\r\n                    <span className=\"text-slate-300\">Accuracy</span>\r\n                    <span className=\"font-semibold text-emerald-400\">\r\n                      {accuracyPct}%\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"h-1.5 w-full overflow-hidden rounded-full bg-slate-800\">\r\n                    <div\r\n                      className=\"h-full rounded-full bg-emerald-500\"\r\n                      style={{\r\n                        width: `${Math.min(100, Number(accuracyPct))}%`\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"grid grid-cols-3 gap-2 text-[11px]\">\r\n                  <div className=\"rounded bg-slate-800 px-2 py-1 text-center\">\r\n                    <p className=\"text-slate-400\">Correct</p>\r\n                    <p className=\"font-mono text-emerald-400\">{s.correct}</p>\r\n                  </div>\r\n                  <div className=\"rounded bg-slate-800 px-2 py-1 text-center\">\r\n                    <p className=\"text-slate-400\">Incorrect</p>\r\n                    <p className=\"font-mono text-rose-400\">{s.incorrect}</p>\r\n                  </div>\r\n                  <div className=\"rounded bg-slate-800 px-2 py-1 text-center\">\r\n                    <p className=\"text-slate-400\">Unattempted</p>\r\n                    <p className=\"font-mono text-amber-300\">\r\n                      {s.unattempted}\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n                <div className=\"text-slate-300 text-[11px]\">\r\n                  Avg time/question:{\" \"}\r\n                  <span className=\"font-mono\">\r\n                    {s.avgTimePerQuestionSeconds.toFixed(1)}s\r\n                  </span>\r\n                </div>\r\n                {s.strengthLabel && (\r\n                  <p className=\"text-[11px] text-sky-300\">{s.strengthLabel}</p>\r\n                )}\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </section>\r\n\r\n      <section className=\"rounded-lg border border-slate-800 bg-slate-900/40 p-4\">\r\n        <div className=\"mb-3 flex items-center justify-between\">\r\n          <h3 className=\"text-sm font-semibold\">Leaderboard (top 10)</h3>\r\n        </div>\r\n        {leaderboard.length === 0 ? (\r\n          <p className=\"text-xs text-slate-400\">\r\n            Not enough attempts yet to build a leaderboard.\r\n          </p>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full text-left text-xs\">\r\n              <thead className=\"border-b border-slate-800 text-slate-400\">\r\n                <tr>\r\n                  <th className=\"px-2 py-1\">Rank</th>\r\n                  <th className=\"px-2 py-1\">User</th>\r\n                  <th className=\"px-2 py-1\">Score</th>\r\n                  <th className=\"px-2 py-1\">Duration</th>\r\n                  <th className=\"px-2 py-1\">Started</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {leaderboard.map((entry) => {\r\n                  const isCurrent =\r\n                    entry.attemptId === attempt._id.toString();\r\n                  return (\r\n                    <tr\r\n                      key={entry.attemptId}\r\n                      className={\r\n                        isCurrent ? \"bg-sky-500/10\" : \"border-b border-slate-900\"\r\n                      }\r\n                    >\r\n                      <td className=\"px-2 py-1 font-semibold\">\r\n                        #{entry.rank}\r\n                      </td>\r\n                      <td className=\"px-2 py-1\">\r\n                        {entry.userId}\r\n                        {isCurrent && (\r\n                          <span className=\"ml-1 rounded bg-sky-500/20 px-1 text-[10px] text-sky-300\">\r\n                            You\r\n                          </span>\r\n                        )}\r\n                      </td>\r\n                      <td className=\"px-2 py-1\">\r\n                        {entry.score}\r\n                      </td>\r\n                      <td className=\"px-2 py-1\">\r\n                        {entry.durationSeconds !== null\r\n                          ? `${Math.round(\r\n                              entry.durationSeconds / 60\r\n                            )} min`\r\n                          : \"-\"}\r\n                      </td>\r\n                      <td className=\"px-2 py-1 text-slate-400\">\r\n                        {new Date(entry.startedAt).toLocaleString()}\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      <div className=\"text-xs\">\r\n        <Link href=\"/\" className=\"text-sky-400 hover:text-sky-300\">\r\n          ← Back to exams\r\n        </Link>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}}]
}